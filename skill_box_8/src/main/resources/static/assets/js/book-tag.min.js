var max = 10;
var offset = 0;
var books = [];
var typeBook = '';
var tag = '';

$(document).ready(function() {

    typeBook = $('#load-books').attr('book-type')
    tag = window.location.href.split('/').pop()

    offset = 0;
    max = $('#load-books').attr('max')

    loadBooks()
});

function changeDate() {
    offset = 0;
    $('#cards-block').empty();

    loadBooks();
}

function loadBooks() {

    const startDate = $('#start-date').val()
    const endDate = $('#end-date').val()

    $.ajax({
        url: `/api/book/${typeBook}/list/${tag}`,
        data: {"offset": offset, "limit": max, "startDate": startDate, "endDate": endDate},
        type: 'GET',
        dataType: 'json',
    }).then(function(data) {

        offset++;

        if (data.isLast || data.books.length == 0) {
            $("#load-books").hide();
            return
        } else {
            $("#load-books").show();
        }

        books.push(data.books);

        for (const book of data.books) {
            $('#cards-block').append(
                '<div class="Card">'+
                `    <div class="Card-picture"><a href="/books/${book.id}"><img src="/assets/img/content/main/card.jpg" alt="card.jpg"/></a>` +
                '    </div>' +
                '    <div class="Card-content">' +
                `        <strong class="Card-title"><a href="#">${book.title}</a>` +
                '        </strong>' +
                `        <div class="Card-description">${book.fioAuthor}` +
                '        </div>' +
                `        <div class="Card-cost"><span class="Card-price">${book.price}</span>` +
                '        </div>' +
                '    </div>' +
                '</div>')
        }
    });
}